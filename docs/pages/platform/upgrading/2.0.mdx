---
meta:
  title: "Upgrading to 2.0"
  parentTitle: "Upgrading"
  description: "Guide to upgrade to Liveblocks version 2.0"
---

Liveblocks 2.0 is our second major release, and focuses on removing any rough
edges and smoothening the developer experience. It make Liveblocks simpler to
set up for new users as well as for existing users. Our long term goal is to
empower you to write and evolve your apps in the best way possible, and at
enterprise scale.

Liveblocks has always embraced the benefits of static typing with TypeScript.
Roughly two years ago, we published 0.17, which introduced the pattern of
calling `createRoomContext()` and returning a “bundle” of type-safe hooks that
you could then use in your application. This pattern worked nicely because all
the hooks were bound to your custom type definitions for `Presence`, `Storage`,
etc. in one single place, and every Liveblocks API would deeply know about it.
No need for manual type annotations anywhere else in your codebase.

There were, however, a couple of downsides to this approach that we have always
been well aware of:

- Importing hooks from a local config file was a little bit awkward. It wasn’t
  an all too familiar pattern for most users.
- Re-exporting the list of hooks took maintenance. If we added a new hook, you’d
  have to also re-export it manually.
- Due to how TypeScript works, the type params you’d provide to
  `createRoomContext()` had a fixed ordering to them. If you wanted to specify
  only `Presence` and `RoomEvent`, ‘you’d have to “skip” other custom types, by
  doing `createRoomContext<Presence, {}, {}, RoomEvent>()` or similar.

With 2.0, this all becomes a lot simpler. We’ve done a lot of internal
refactoring to make this possible.

Let’s dive in and show you how to simplify your Liveblocks application.

We’ll first go over all the breaking changes, then we’ll show you how to
simplify your codebase.

- [Upgrading your Liveblocks packages](#upgrading)
- [Possible breaking changes](#breaking-changes)
  - [Breaking change 1](#bc1)
  - [Breaking change 2](#bc2)
  - [Breaking change 3](#bc3)
  - [Breaking change 4](#bc4)
  - [Breaking change 5](#bc5)
  - [Breaking change 6](#bc6)
  - [Breaking change 7](#bc7)
- [Simplifying your Liveblocks application](#simplifying) (optional)
  - [Step 1](#step1)
  - [Step 2](#step2)
  - [Step 3](#step3)
- [Improvements](#improvements)

## Upgrade your Liveblocks packages [#upgrading]

First of all, let’s upgrade all Liveblocks dependencies to their latest
versions. The easiest way to do that is to run the following command:

```bash
npx create-liveblocks-app@latest --upgrade
```

## Possible breaking changes [#breaking-changes]

Most APIs will be backward compatible. However, there is a chance that some of
these breaking changes will affect your code base. Many of these changes are
trivial to adjust to.

<Banner type="success" title="Codemods are available">

We have codemods available for most of these breaking changes.

</Banner>

### Breaking change 1: renamed package [#bc1]

We’ve renamed our package `@liveblocks/react-comments` to
`@liveblocks/react-ui`, because our library of pre-built UI components now
contains more than just Comments-related components, we’ve renamed our package
accordingly, so please adjust your imports.

There is a **codemod available** for you to run to perform this code change:

```bash
npx @liveblocks/codemod@latest react-comments-to-react-ui
```

This will change your imports like this:

```diff showLineNumbers={false}
-import { Thread } from "@liveblocks/react-comments"
+import { Thread } from "@liveblocks/react-ui"
```

And also:

```diff showLineNumbers={false}
-<CommentsConfig />
+<LiveblocksUIConfig />
```

### Breaking change 2: renamed exports in our Node package [#bc2]

To avoid confusion with the newly introduced custom `RoomInfo` type, we’ve
renamed the `RoomInfo` type in our Node package.

There is a codemod available for you to run to perform this code change:

```bash
npx @liveblocks/codemod@latest room-info-to-room-data
```

This will change:

```diff showLineNumbers={false}
-import { RoomInfo } from "@liveblocks/node"
+import { RoomData } from "@liveblocks/node"

-const rooms: RoomInfo[] = []
+const rooms: RoomData[] = []
```

### Breaking change 3: client methods from our Node package no longer take type params [#bc3]

In `@liveblocks/node`, none of the client methods, like `client.getThread()`,
take type params any longer.

```diff showLineNumbers={false}
-const thread = client.getThread<MyThreadMetadata>()
+const thread = client.getThread()
```

You should use global type augmentation instead. Please see
[“Simplifying your Liveblocks application”](#simplifying) below for a lot more
detail on this transition.

```tsx showLineNumbers={false}
declare global {
  interface Liveblocks {
    ThreadMetadata: MyThreadMetadata;
  }
}
```

### Breaking change 4: changed default export to named export in Yjs package [#bc4]

To make discoverability and refactorings easier, and to avoid confusion with the
newly introduced `LiveblocksProvider` in our React package, we’re no longer
using default exports, but named exports only:

Change:

```diff showLineNumbers={false}
-import LiveblocksProvider from "@liveblocks/yjs";
+import { LiveblocksYjsProvider } from "@liveblocks/yjs";
```

<Banner type="warning" title="We’re working on a codemod">

We are working on a codemod for this step, and will update this guide when it’s
ready.

</Banner>

### Breaking change 5: minor LiveList constructor change [#bc5]

The `LiveList()` constructor’s argument is no longer optional, because it causes
unneeded but confusing type inference issues:

```diff showLineNumbers={false}
-const mylist = new LiveList();
+const mylist = new LiveList([]);
```

<Banner type="warning" title="We’re working on a codemod">

We are working on a codemod for this step, and will update this guide when it’s
ready.

</Banner>

### Breaking change 6: new webhook event types [#bc6]

TODO: Detail this section

The webhook event `NotificationEvent`’s type can represent multiple kinds of
notifications (`"thread"`, `"textMention"`, and custom ones (e.g.
`"$myNotification"`)).

### Breaking change 7: removed deprecated APIs [#bc7]

All of the following APIs have been removed in 2.0. These all were deprecated
multiple versions ago:

- The `useMap`, `useList`, and `useObject` hooks. These have been deprecated
  since the release of 0.18 (more than two years ago). Please see
  [the 0.18 upgrade guide](/docs/platform/upgrading/0.18#Step-5a:-Replace-reads-with-useStorage)
  for tips on how to rewrite these hooks to `useStorage`.
- Remove legacy `authorize` method from `@liveblocks/node`. Please refer to
  [the 1.2 upgrade guide](/docs/platform/upgrading/1.2#how) to learn how to
  upgrade your auth endpoint.
- Legacy connection status APIs, e.g. `room.getConnectionState()` and
  `.subscribe("connection")`. You can use `.getStatus()` or
  `.subscribe("status")` instead.
- Legacy option `shouldInitiallyConnect` is now renamed to `autoConnect`
- `Client.enter()` has been replaced by `Client.enterRoom()`
- `Client.leave()` has been replaced by `Client.enterRoom()`, which returns a
  `leave` function
- Legacy exports in Zustand/Redux packages
- Client option `fetchPolyfill`, `WebSocketPolyfill`, are replaced by
  `polyfills: { fetch, WebSocket }`
- The `Others<P, U>` type. Please change to `readonly User<P, U>[]`.
- `user.isReadOnly` field is replaced by `!user.canWrite` (note the negation
  here)
- The second argument `options` to `createRoomContext(client, options)` has been
  removed. These options have been moved to the client.

## Simplifying your Liveblocks application (optional) [#simplifying]

If you have dealt with the breaking changes above, or concluded they they don’t
apply to your situation, we can go a step further and really simplify your
Liveblocks setup.

**Note:** If your Liveblocks application has multiple room types, and therefore
you have more than one instance of `createRoomContext()` in your application,
the following simplification does not apply to you. We will keep supporting
`createRoomContext()` for the advanced use case of multiple room types.

### Step 1: Use the new global Liveblocks custom types [#step1]

Go to your `liveblocks.config.ts`, find your `createRoomContext()` call. Now
decide which codemod to run.

**Option 1**: If you have `const { suspense: { ... } } = createRoomContext()`,
run:

```bash
npx @liveblocks/codemod@latest remove-liveblocks-config-contexts --suspense
```

**Option 2**: If instead you have `const { ... } = createRoomContext()`, run:

```bash
npx @liveblocks/codemod@latest remove-liveblocks-config-contexts
```

This codemod will make the following changes to your code.

First it will move your type annotations to a global `Liveblocks` interface,
which all Liveblocks API will recognize and use:

```diff showLineNumbers={false}
+declare global {
+  interface Liveblocks {
+    Presence: MyPresence;
+    Storage: MyStorage;
+    UserMeta: MyUserMeta;
+    RoomEvent: MyRoomEvent;
+    ThreadMetadata: MyThreadMetadata;
+  }
+}
+
-const { ... } = createRoomContext<MyPresence, MyStorage, MyUserMeta, MyRoomEvent, MyThreadMetadata>(client);
```

Secondly, it will change all imports in your code base to import the hooks
directly instead:

```diff showLineNumbers={false}
-import { RoomProvider, useRoom, useThreads } from "./liveblocks.config.ts";
+import { RoomProvider, useRoom, useThreads } from "@liveblocks/react/suspense";
```

### Step 2: Set up a LiveblocksProvider [#step2]

At this point, there should not be any new TypeScript issues. However, running
the code will not yet work. This is because previously the hooks were bound to
the `client` instance by passing it to the `createRoomContext()` factory, which
we now removed. When using the global types, we’ll have to provide the
Liveblocks client otherwise.

The way to do it is to use a pretty standard React provider. Make the following
change:

```diff showLineNumbers={false}
 // In liveblocks.config.ts
-import { createClient } from "@liveblocks/client";
-
-const client = createClient({
-  authEndpoint: "/api/liveblocks-auth",
-  throttle: 16,
-  /* etc */
-);

 // High up in your component tree
+"use client";
+
+import { LiveblocksProvider } from "@liveblocks/react";
+
+function Layout({ children }) {
+  return (
+    <LiveblocksProvider
+      authEndpoint="/api/liveblocks-auth"
+      throttle={16}
+      /* etc */
+    >
+      {children}
+    </LiveblocksProvider>
+  )
+}
```

<Banner type="info" title="Where to put this?">

We recommend placing the `LiveblocksProvider` as high up your component tree as
you can, preferably in your `_app.tsx` or `layout.tsx` (or equivalent for your
React framework of choice). Unfortunately, we cannot provide a codemod for this
step, because we cannot mechanically decide where exactly to inject the
Liveblocks provider in your application.

</Banner>

If you were exporting the `client` instance before and have components that
directly accessed it before, you can now obtain a reference to the `client`
instance that the `LiveblocksProvider` creates for you using the `useClient`
hook:

```diff
-import { client } from "./liveblocks.config";
+import { useClient } from "@liveblocks/react/suspense";

+function MyComponent() {
+  const client = useClient();
+}
```

### Step 3: Optional cleanup of type annotations [#step3]

If you also exported your `Presence`, `Storage`, etc types from
`liveblocks.config.ts` before, you no longer have to. The main reason to export
these before was to use them in helper functions that used some of the
Liveblocks types, like `User`, or `Room`.

For example:

```tsx
import type { Room, User } from "@liveblocks/client";
import type { MyPresence, MyStorage } from "./liveblocks.config";

function isAdult(user: User<MyPresence, MyUserMeta>) {
  return user.info.age >= 18;
  //               ^^^ Coming from MyUserMeta
}

function doSomethingWithRoom(
  room: Room<MyPresence, MyStorage, MyUserMeta, never>
) {
  /* ... */
}
```

This is no longer needed. You can simply remove them.

```tsx
import type { Room, User } from "@liveblocks/client";

function isAdult(user: User) {
  return user.info.age >= 18;
  //               ^^^ Still coming from configured UserMeta custom type
}

function doSomethingWithRoom(room: Room) {
  /* ... */
}
```

## Improvements

The following miscellaneous improvements have been made that are non-breaking
changes:

### `ClientSideSuspense` no longer needs a function

Previously, the `ClientSideSuspense` helper needed a function as its `children`
prop, but it no longer has to.

You can now change:

```diff
 function MyComponent() {
   return (
     <ClientSideSuspense fallback={<Loading />}>
-      {() => <MyApp />}
+      <MyApp />
     </ClientSideSuspense>
   );
 }
```

### Improved `InboxNotification` props types

TODO: Detail this section

### New custom type `RoomInfo`

By using the [`resolveRoomsInfo`][] callback from [`createClient`][] or the new
[`LiveblocksProvider`][], you can attach arbitrary room data to a room, which
you can retrieve with the [`useRoomInfo`][] hook.

Both of these APIs will now respect the type you provide via:

```tsx
declare global {
  interface Liveblocks {
    RoomInfo: {
      /* your custom type definition here */
    };
  }
}
```

[`createClient`]: /docs/api-reference/liveblocks-client#createClient
[`LiveblocksProvider`]: /docs/api-reference/liveblocks-react#LiveblocksProvider
[`resolveRoomsInfo`]:
  /docs/api-reference/liveblocks-client#createClientResolveRoomsInfo
[`useRoomInfo`]: /docs/api-reference/liveblocks-react#useRoomInfo
